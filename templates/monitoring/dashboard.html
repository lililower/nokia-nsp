{% extends "base.html" %}

{% block title %}Dashboard - Nokia NSP{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Stats Cards -->
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card stat-card border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="rounded-circle bg-primary bg-opacity-10 p-3 me-3">
            <i class="bi bi-router text-primary fs-4"></i>
          </div>
          <div>
            <h3 class="mb-0">{{ device_count }}</h3>
            <small class="text-muted">Total Devices</small>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stat-card border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="rounded-circle bg-success bg-opacity-10 p-3 me-3">
            <i class="bi bi-check-circle text-success fs-4"></i>
          </div>
          <div>
            <h3 class="mb-0">{{ online_count }}</h3>
            <small class="text-muted">Online</small>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stat-card border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="rounded-circle bg-info bg-opacity-10 p-3 me-3">
            <i class="bi bi-diagram-3 text-info fs-4"></i>
          </div>
          <div>
            <h3 class="mb-0">{{ service_count }}</h3>
            <small class="text-muted">Services</small>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stat-card border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="rounded-circle bg-warning bg-opacity-10 p-3 me-3">
            <i class="bi bi-cloud-check text-warning fs-4"></i>
          </div>
          <div>
            <h3 class="mb-0">{{ deployed_count }}</h3>
            <small class="text-muted">Deployed</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-3">
  <!-- Devices -->
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0"><i class="bi bi-router me-2"></i>Devices</h6>
        <a href="{% url 'device_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
      </div>
      <div class="card-body p-0">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Hostname</th>
              <th>Platform</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for device in devices %}
            <tr>
              <td><a href="{% url 'device_detail' device.pk %}">{{ device.name }}</a></td>
              <td>{{ device.hostname }}</td>
              <td>{{ device.platform }}</td>
              <td>
                {% if device.status == 'online' %}
                  <span class="badge bg-success">Online</span>
                {% elif device.status == 'offline' %}
                  <span class="badge bg-danger">Offline</span>
                {% else %}
                  <span class="badge bg-secondary">Unknown</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="4" class="text-center text-muted py-3">No devices added yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Recent Deployment Logs -->
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0"><i class="bi bi-journal-text me-2"></i>Recent Deployments</h6>
        <a href="{% url 'deployment_logs' %}" class="btn btn-sm btn-outline-primary">View All</a>
      </div>
      <div class="card-body p-0">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Service</th>
              <th>Device</th>
              <th>Action</th>
              <th>Status</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody>
            {% for log in recent_logs %}
            <tr>
              <td><a href="{% url 'service_detail' log.service.pk %}">VPLS {{ log.service.service_id }}</a></td>
              <td>{{ log.device.name }}</td>
              <td><span class="text-capitalize">{{ log.action }}</span></td>
              <td>
                {% if log.status == 'success' %}
                  <span class="badge bg-success">Success</span>
                {% else %}
                  <span class="badge bg-danger">Failed</span>
                {% endif %}
              </td>
              <td><small>{{ log.timestamp|timesince }} ago</small></td>
            </tr>
            {% empty %}
            <tr><td colspan="5" class="text-center text-muted py-3">No deployments yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
